<mat-card style="max-width: 800px; margin: 2rem auto;">
    <mat-card-header>
        <mat-card-title>Gestão de Notas Fiscais</mat-card-title>
        <mat-card-subtitle>Visualize e processe (imprima) as notas fiscais abertas.</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>

        <div *ngIf="isLoading" style="text-align: center; padding: 2rem;">
            <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
            <p style="font-style: italic; margin-top: 1rem;">Carregando notas fiscais...</p>
        </div>

        <div *ngIf="erroApi && !isLoading" class="api-error">
            <strong>Erro ao carregar:</strong> {{ erroApi }}
        </div>

        <mat-tab-group *ngIf="!isLoading" (selectedTabChange)="separarNotas()">

            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon style="margin-right: 8px;">folder_open</mat-icon>
                    Abertas ({{dataSourceAbertas.data.length}})
                </ng-template>

                <div class="table-container">
                    <table mat-table [dataSource]="dataSourceAbertas">

                        <ng-container matColumnDef="numero">
                            <th mat-header-cell *matHeaderCellDef> N° Nota </th>
                            <td mat-cell *matCellDef="let nota"> {{nota.numero}} </td>
                        </ng-container>

                        <ng-container matColumnDef="itens">
                            <th mat-header-cell *matHeaderCellDef> Itens </th>
                            <td mat-cell *matCellDef="let nota">
                                {{nota.itens.length}} item(ns)
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="acoes">
                            <th mat-header-cell *matHeaderCellDef> Ações </th>
                            <td mat-cell *matCellDef="let nota">

                                <button mat-flat-button color="primary" (click)="onImprimir(nota.numero)"
                                    [disabled]="imprimindoNotaNum === nota.numero">
                                    <mat-progress-spinner *ngIf="imprimindoNotaNum === nota.numero" mode="indeterminate"
                                        diameter="20"
                                        style="display: inline-block; margin-right: 8px;"></mat-progress-spinner>
                                    {{ imprimindoNotaNum === nota.numero ? 'Processando...' : 'Imprimir' }}
                                </button>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumnsAbertas"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumnsAbertas;"></tr>
                    </table>
                    <mat-paginator #paginatorAbertas [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons
                        aria-label="Selecione a página de notas abertas">
                    </mat-paginator>
                    <div *ngIf="dataSourceAbertas.data.length === 0" class="empty-table">
                        Nenhuma nota fiscal aberta.
                    </div>
                </div>
            </mat-tab>

            <mat-tab>
                <ng-template mat-tab-label>
                    <mat-icon style="margin-right: 8px;">check_circle</mat-icon>
                    Fechadas ({{dataSourceFechadas.data.length}})
                </ng-template>

                <div class="table-container">
                    <table mat-table [dataSource]="dataSourceFechadas">

                        <ng-container matColumnDef="numero">
                            <th mat-header-cell *matHeaderCellDef> N° Nota </th>
                            <td mat-cell *matCellDef="let nota"> {{nota.numero}} </td>
                        </ng-container>

                        <ng-container matColumnDef="itens">
                            <th mat-header-cell *matHeaderCellDef> Itens </th>
                            <td mat-cell *matCellDef="let nota">
                                {{nota.itens.length}} item(ns)
                            </td>
                        </ng-container>

                        <ng-container matColumnDef="status">
                            <th mat-header-cell *matHeaderCellDef> Status </th>
                            <td mat-cell *matCellDef="let nota" style="color: green; font-weight: 500;">
                                {{nota.status}}
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedColumnsFechadas"></tr>
                        <tr mat-row *matRowDef="let row; columns: displayedColumnsFechadas;"></tr>
                    </table>
                    <mat-paginator #paginatorFechadas [pageSizeOptions]="[5, 10, 25]" showFirstLastButtons
                        aria-label="Selecione a página de notas fechadas">
                    </mat-paginator>
                    <div *ngIf="dataSourceFechadas.data.length === 0" class="empty-table">
                        Nenhuma nota fiscal fechada.
                    </div>
                </div>
            </mat-tab>

        </mat-tab-group>

    </mat-card-content>
</mat-card>